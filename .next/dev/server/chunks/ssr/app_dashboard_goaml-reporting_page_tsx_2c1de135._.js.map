{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/sunny/Documents/sanction/app/dashboard/goaml-reporting/page.tsx"],"sourcesContent":["\"use client\"\nimport Link from \"next/link\"\nimport { useState, useEffect, useCallback } from \"react\"\nimport { useAuthStore } from \"@/lib/store\"\n\nexport default function GoamlReportingPage() {\n  const [reports, setReports] = useState<any[]>([])\n  const [page, setPage] = useState(1)\n  const [total, setTotal] = useState(0)\n\n  const [search, setSearch] = useState(\"\")\n  const [debouncedSearch, setDebouncedSearch] = useState(\"\")\n\n  const [refreshKey, setRefreshKey] = useState(0)\n  const { user } = useAuthStore()\n  const normalizedRole = user?.role.toLowerCase().trim()\n\n  // Debounce search input by 500ms\n  useEffect(() => {\n    const t = setTimeout(() => setDebouncedSearch(search), 500)\n    return () => clearTimeout(t)\n  }, [search])\n\n  const fetchReports = useCallback(async () => {\n    const qs = new URLSearchParams()\n    qs.set(\"limit\", \"10\")\n    qs.set(\"offset\", String(page))\n    if (debouncedSearch.trim()) qs.set(\"search\", debouncedSearch.trim())\n\n    const res = await fetch(`/api/goaml/reports?${qs.toString()}`, {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: { \"Content-Type\": \"application/json\" },\n      cache: \"no-store\",\n    })\n\n    const json = await res.json()\n    console.log(\"Fetched GOAML Reports:\", json)\n\n    if (json?.status) {\n      setReports(json.data?.reports || [])\n      setTotal(json.data?.total || 0)\n    } else {\n      setReports([])\n      setTotal(0)\n    }\n  }, [page, debouncedSearch])\n\n  // When debounced search changes, reset to page 1\n  useEffect(() => {\n    setPage(1)\n  }, [debouncedSearch])\n\n  useEffect(() => {\n    fetchReports()\n  }, [fetchReports, refreshKey])\n\n  return (\n    <div className=\"p-6\">\n      {/* Notice banner */}\n      {/* <div className=\"mb-4 rounded border border-orange-300 bg-orange-50 text-orange-800 p-3\">\n        <b>Notice !</b> Please update the identification issue details for all existing corporate customers' UBO, Partner, or Authorised Person to facilitate a seamless GOAML process.\n      </div> */}\n\n      {/* Header actions */}\n      <div className=\"flex justify-between items-center mb-4\">\n        <h2 className=\"text-xl font-bold\">GOAML Reporting</h2>\n        <div className=\"flex gap-2\">\n          <button\n            className=\"px-3 py-2 rounded border text-sm\"\n            onClick={() => setRefreshKey((k) => k + 1)}\n          >\n            Refresh\n          </button>\n          {/* {normalizedRole !== \"analyst\" && ( */}\n            <Link href=\"/dashboard/goaml-reporting/create\" className=\"px-3 py-2 rounded bg-blue-600 text-white text-sm\">+ Create New Report</Link>\n          {/* )} */}\n          {/* <button className=\"px-3 py-2 rounded border text-sm\">Validate XML File</button> */}\n        </div>\n      </div>\n\n      {/* Card container */}\n      <div className=\"rounded border bg-white\">\n        <div className=\"p-4 border-b\">\n          <input\n            type=\"text\"\n            placeholder=\"Search by customer name, ID, type, entity reference, or amount...\"\n            className=\"p-2 border rounded w-full\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n          />\n        </div>\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full\">\n            <thead>\n              <tr className=\"bg-gray-50 text-left\">\n                <th className=\"p-3 border-b\">Sl No.</th>\n                <th className=\"p-3 border-b\">Entity Reference No</th>\n                <th className=\"p-3 border-b\">Customer Name</th>\n                <th className=\"p-3 border-b\">Customer ID</th>\n                <th className=\"p-3 border-b\">Customer Type</th>\n                <th className=\"p-3 border-b\">Amount</th>\n                <th className=\"p-3 border-b\">Created Date</th>\n                <th className=\"p-3 border-b\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {reports.map((r: any, idx: number) => (\n                <tr key={r.id || idx} className=\"hover:bg-gray-50\">\n                  <td className=\"p-3 border-b\">{(page - 1) * 10 + idx + 1}</td>\n                  <td className=\"p-3 border-b\">{r.entity_reference || r.entityRefNo || \"-\"}</td>\n                  <td className=\"p-3 border-b\">{r.customer_name || r.customerName || \"-\"}</td>\n                  <td className=\"p-3 border-b\">{r.customer_id || r.customerId || \"-\"}</td>\n                  <td className=\"p-3 border-b\">\n                    <span className=\"bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs\">\n                      {r.customer.customer_type || r.customer.customer_type || \"-\"}\n                    </span>\n                  </td>\n                  <td className=\"p-3 border-b\">{r.estimated_value ?? \"-\"}</td>\n                  <td className=\"p-3 border-b\">{r.created_at ? new Date(r.created_at).toLocaleDateString() : r.createdDate || \"-\"}</td>\n                  <td className=\"p-3 border-b\">\n                    <div className=\"flex gap-2\">\n                      {user?.role !== \"Analyst\" && (\n                        <>\n                          <Link href={`/dashboard/goaml-reporting/edit/${r.id}`}>\n                            <button className=\"px-2 py-1 rounded border text-xs\">‚úèÔ∏è</button>\n                          </Link>\n                          <button className=\"px-2 py-1 rounded border text-xs\">üóëÔ∏è</button>\n                        </>\n                      )}\n                      <Link href={`/dashboard/goaml-reporting/${r.id}`} className=\"px-2 py-1 rounded border text-xs\">View</Link>\n                    </div>\n                  </td>\n                </tr>\n              ))}\n              {reports.length === 0 && (\n                <tr>\n                  <td className=\"p-4 text-center text-sm text-gray-500\" colSpan={8}>No reports found</td>\n                </tr>\n              )}\n            </tbody>\n          </table>\n        </div>\n        {/* Footer with pagination */}\n        <div className=\"p-4 flex items-center justify-between\">\n          <span className=\"text-sm text-gray-600\">Showing {(page - 1) * 10 + 1} to {Math.min(page * 10, total)} of {total} entries</span>\n          <div className=\"flex items-center gap-2\">\n            <button className=\"px-2 py-1 rounded border text-sm\" disabled={page === 1} onClick={() => setPage(page - 1)}>&lt;</button>\n            {/* simple numbered pages mimic */}\n            <span className=\"px-2 py-1 rounded bg-blue-600 text-white text-sm\">{page}</span>\n            <button className=\"px-2 py-1 rounded border text-sm\" disabled={reports.length < 10} onClick={() => setPage(page + 1)}>&gt;</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AAHA;;;;;AAKe,SAAS;IACtB,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iVAAQ,EAAQ,EAAE;IAChD,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iVAAQ,EAAC;IACjC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iVAAQ,EAAC;IAEnC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iVAAQ,EAAC;IACrC,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iVAAQ,EAAC;IAEvD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iVAAQ,EAAC;IAC7C,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,4HAAY;IAC7B,MAAM,iBAAiB,MAAM,KAAK,cAAc;IAEhD,iCAAiC;IACjC,IAAA,kVAAS,EAAC;QACR,MAAM,IAAI,WAAW,IAAM,mBAAmB,SAAS;QACvD,OAAO,IAAM,aAAa;IAC5B,GAAG;QAAC;KAAO;IAEX,MAAM,eAAe,IAAA,oVAAW,EAAC;QAC/B,MAAM,KAAK,IAAI;QACf,GAAG,GAAG,CAAC,SAAS;QAChB,GAAG,GAAG,CAAC,UAAU,OAAO;QACxB,IAAI,gBAAgB,IAAI,IAAI,GAAG,GAAG,CAAC,UAAU,gBAAgB,IAAI;QAEjE,MAAM,MAAM,MAAM,MAAM,CAAC,mBAAmB,EAAE,GAAG,QAAQ,IAAI,EAAE;YAC7D,QAAQ;YACR,aAAa;YACb,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,OAAO;QACT;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,QAAQ,GAAG,CAAC,0BAA0B;QAEtC,IAAI,MAAM,QAAQ;YAChB,WAAW,KAAK,IAAI,EAAE,WAAW,EAAE;YACnC,SAAS,KAAK,IAAI,EAAE,SAAS;QAC/B,OAAO;YACL,WAAW,EAAE;YACb,SAAS;QACX;IACF,GAAG;QAAC;QAAM;KAAgB;IAE1B,iDAAiD;IACjD,IAAA,kVAAS,EAAC;QACR,QAAQ;IACV,GAAG;QAAC;KAAgB;IAEpB,IAAA,kVAAS,EAAC;QACR;IACF,GAAG;QAAC;QAAc;KAAW;IAE7B,qBACE,8WAAC;QAAI,WAAU;;0BAOb,8WAAC;gBAAI,WAAU;;kCACb,8WAAC;wBAAG,WAAU;kCAAoB;;;;;;kCAClC,8WAAC;wBAAI,WAAU;;0CACb,8WAAC;gCACC,WAAU;gCACV,SAAS,IAAM,cAAc,CAAC,IAAM,IAAI;0CACzC;;;;;;0CAIC,8WAAC,uSAAI;gCAAC,MAAK;gCAAoC,WAAU;0CAAmD;;;;;;;;;;;;;;;;;;0BAOlH,8WAAC;gBAAI,WAAU;;kCACb,8WAAC;wBAAI,WAAU;kCACb,cAAA,8WAAC;4BACC,MAAK;4BACL,aAAY;4BACZ,WAAU;4BACV,OAAO;4BACP,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;kCAG7C,8WAAC;wBAAI,WAAU;kCACb,cAAA,8WAAC;4BAAM,WAAU;;8CACf,8WAAC;8CACC,cAAA,8WAAC;wCAAG,WAAU;;0DACZ,8WAAC;gDAAG,WAAU;0DAAe;;;;;;0DAC7B,8WAAC;gDAAG,WAAU;0DAAe;;;;;;0DAC7B,8WAAC;gDAAG,WAAU;0DAAe;;;;;;0DAC7B,8WAAC;gDAAG,WAAU;0DAAe;;;;;;0DAC7B,8WAAC;gDAAG,WAAU;0DAAe;;;;;;0DAC7B,8WAAC;gDAAG,WAAU;0DAAe;;;;;;0DAC7B,8WAAC;gDAAG,WAAU;0DAAe;;;;;;0DAC7B,8WAAC;gDAAG,WAAU;0DAAe;;;;;;;;;;;;;;;;;8CAGjC,8WAAC;;wCACE,QAAQ,GAAG,CAAC,CAAC,GAAQ,oBACpB,8WAAC;gDAAqB,WAAU;;kEAC9B,8WAAC;wDAAG,WAAU;kEAAgB,CAAC,OAAO,CAAC,IAAI,KAAK,MAAM;;;;;;kEACtD,8WAAC;wDAAG,WAAU;kEAAgB,EAAE,gBAAgB,IAAI,EAAE,WAAW,IAAI;;;;;;kEACrE,8WAAC;wDAAG,WAAU;kEAAgB,EAAE,aAAa,IAAI,EAAE,YAAY,IAAI;;;;;;kEACnE,8WAAC;wDAAG,WAAU;kEAAgB,EAAE,WAAW,IAAI,EAAE,UAAU,IAAI;;;;;;kEAC/D,8WAAC;wDAAG,WAAU;kEACZ,cAAA,8WAAC;4DAAK,WAAU;sEACb,EAAE,QAAQ,CAAC,aAAa,IAAI,EAAE,QAAQ,CAAC,aAAa,IAAI;;;;;;;;;;;kEAG7D,8WAAC;wDAAG,WAAU;kEAAgB,EAAE,eAAe,IAAI;;;;;;kEACnD,8WAAC;wDAAG,WAAU;kEAAgB,EAAE,UAAU,GAAG,IAAI,KAAK,EAAE,UAAU,EAAE,kBAAkB,KAAK,EAAE,WAAW,IAAI;;;;;;kEAC5G,8WAAC;wDAAG,WAAU;kEACZ,cAAA,8WAAC;4DAAI,WAAU;;gEACZ,MAAM,SAAS,2BACd;;sFACE,8WAAC,uSAAI;4EAAC,MAAM,CAAC,gCAAgC,EAAE,EAAE,EAAE,EAAE;sFACnD,cAAA,8WAAC;gFAAO,WAAU;0FAAmC;;;;;;;;;;;sFAEvD,8WAAC;4EAAO,WAAU;sFAAmC;;;;;;;;8EAGzD,8WAAC,uSAAI;oEAAC,MAAM,CAAC,2BAA2B,EAAE,EAAE,EAAE,EAAE;oEAAE,WAAU;8EAAmC;;;;;;;;;;;;;;;;;;+CAtB5F,EAAE,EAAE,IAAI;;;;;wCA2BlB,QAAQ,MAAM,KAAK,mBAClB,8WAAC;sDACC,cAAA,8WAAC;gDAAG,WAAU;gDAAwC,SAAS;0DAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;kCAO5E,8WAAC;wBAAI,WAAU;;0CACb,8WAAC;gCAAK,WAAU;;oCAAwB;oCAAS,CAAC,OAAO,CAAC,IAAI,KAAK;oCAAE;oCAAK,KAAK,GAAG,CAAC,OAAO,IAAI;oCAAO;oCAAK;oCAAM;;;;;;;0CAChH,8WAAC;gCAAI,WAAU;;kDACb,8WAAC;wCAAO,WAAU;wCAAmC,UAAU,SAAS;wCAAG,SAAS,IAAM,QAAQ,OAAO;kDAAI;;;;;;kDAE7G,8WAAC;wCAAK,WAAU;kDAAoD;;;;;;kDACpE,8WAAC;wCAAO,WAAU;wCAAmC,UAAU,QAAQ,MAAM,GAAG;wCAAI,SAAS,IAAM,QAAQ,OAAO;kDAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMlI"}}]
}