{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/sunny/Documents/sanction/app/api/onboarding/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\n\nfunction getTokenFromCookie(cookie: string): string | null {\n  const match = cookie.match(/session_token=([^;]+)/)\n  return match ? match[1] : null\n}\n\nexport async function POST(req: Request) {\n  const cookie = req.headers.get(\"cookie\") || \"\"\n  const token = getTokenFromCookie(cookie)\n  const decodedToken = token ? decodeURIComponent(token) : null\n\n  // Debug: log incoming request\n  console.log(\"[API] /api/onboarding called\")\n  console.log(\"Method:\", req.method)\n  console.log(\"Headers:\", Object.fromEntries(req.headers.entries()))\n\n  // Try to parse FormData\n  let formData: FormData | null = null\n  let jsonData: any = null\n  let files: any[] = []\n  try {\n    if (req.headers.get(\"content-type\")?.includes(\"multipart/form-data\")) {\n      formData = await req.formData()\n      for (const [key, value] of formData.entries()) {\n        if (key === \"data\" && typeof value === \"string\") {\n          jsonData = JSON.parse(value)\n          console.log(\"Payload data:\", jsonData)\n        } else if (key === \"documents[]\" && value instanceof File) {\n          files.push({ name: value.name, size: value.size, type: value.type })\n        }\n      }\n      console.log(\"Uploaded files:\", files)\n    } else {\n      const body = await req.text()\n      jsonData = JSON.parse(body)\n      console.log(\"Payload data:\", jsonData)\n    }\n  } catch (err) {\n    console.error(\"Error parsing request body:\", err)\n  }\n\n  const headers: Record<string, string> = {\n    \"Content-Type\": req.headers.get(\"content-type\") || \"application/json\",\n  }\n  if (decodedToken) {\n    headers[\"Authorization\"] = `Bearer ${decodedToken}`\n  }\n\n  let forwardBody: any = null\n  let forwardHeaders = { ...headers }\n  if (formData) {\n    // Reconstruct FormData for forwarding\n    forwardBody = new FormData()\n    for (const [key, value] of formData.entries()) {\n      forwardBody.append(key, value)\n    }\n    // Remove Content-Type so fetch sets correct boundary\n    delete forwardHeaders[\"Content-Type\"]\n  } else if (jsonData) {\n    forwardBody = JSON.stringify(jsonData)\n  }\n\n  // Forward request to Laravel\n  let res: Response\n  try {\n    console.log(\"[API] Forwarding to Laravel...\")\n    console.log(`[API] Target URL: ${process.env.NEXT_PUBLIC_API_BASE_URL}/api/onboarding`)\n    console.log(\"[API] Headers being sent:\", forwardHeaders)\n    console.log(\"[API] Body type:\", forwardBody instanceof FormData ? \"FormData\" : typeof forwardBody)\n    \n    const controller = new AbortController()\n    const timeoutId = setTimeout(() => {\n      console.log(\"[API] Request timeout after 30 seconds\")\n      controller.abort()\n    }, 30000) // 30 second timeout\n\n    const startTime = Date.now()\n    res = await fetch(`${process.env.NEXT_PUBLIC_API_BASE_URL}/api/onboarding`, {\n      method: \"POST\",\n      headers: forwardHeaders,\n      credentials: \"include\",\n      body: forwardBody,\n      signal: controller.signal,\n    })\n\n    clearTimeout(timeoutId)\n    const elapsed = Date.now() - startTime\n    console.log(`[API] Laravel responded with status ${res.status} in ${elapsed}ms`)\n  } catch (fetchErr: any) {\n    console.error(\"[API] Failed to reach Laravel backend:\", fetchErr)\n    console.error(\"[API] Error name:\", fetchErr.name)\n    console.error(\"[API] Error message:\", fetchErr.message)\n    return NextResponse.json(\n      {\n        status: false,\n        message: fetchErr.name === \"AbortError\" \n          ? \"Request timeout - Laravel server not responding\" \n          : `Cannot connect to Laravel backend: ${fetchErr.message}`,\n        error: \"Backend connection failed\",\n      },\n      { status: 503 }\n    )\n  }\n\n  const contentType = res.headers.get(\"content-type\") || \"\"\n  const responseText = await res.text()\n  console.log(\"[API] Laravel onboarding response status:\", res.status)\n  console.log(\"[API] Laravel onboarding response body:\", responseText)\n\n  if (!res.ok) {\n    // Try to return JSON error if possible, otherwise include raw text\n    if (contentType.includes(\"application/json\")) {\n      try {\n        const jsonErr = JSON.parse(responseText)\n        console.log(\"[API] Returning parsed error JSON:\", jsonErr)\n        return NextResponse.json(jsonErr, { status: res.status })\n      } catch (parseErr) {\n        console.error(\"[API] Failed to parse error JSON:\", parseErr)\n        // fallthrough to text\n      }\n    }\n    console.log(\"[API] Returning error as plain text\")\n    return NextResponse.json(\n      {\n        status: false,\n        message: responseText || \"Unknown error\",\n        error: responseText || \"Unknown error\",\n      },\n      { status: res.status }\n    )\n  }\n\n  // Success: parse JSON if possible, otherwise return text as a JSON message\n  if (contentType.includes(\"application/json\")) {\n    try {\n      const data = JSON.parse(responseText)\n      console.log(\"[API] Returning success JSON:\", data)\n      return NextResponse.json(data)\n    } catch {\n      // fall through to send as message\n    }\n  }\n  return NextResponse.json({ status: true, message: responseText }, { status: res.status })\n}\n"],"names":[],"mappings":"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"}}]
}