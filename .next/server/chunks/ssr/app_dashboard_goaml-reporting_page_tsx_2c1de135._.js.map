{"version":3,"sources":["../../../../app/dashboard/goaml-reporting/page.tsx"],"sourcesContent":["\"use client\"\nimport Link from \"next/link\"\nimport { useState, useEffect, useCallback } from \"react\"\nimport { useAuthStore } from \"@/lib/store\"\n\nexport default function GoamlReportingPage() {\n  const [reports, setReports] = useState<any[]>([])\n  const [page, setPage] = useState(1)\n  const [total, setTotal] = useState(0)\n\n  const [search, setSearch] = useState(\"\")\n  const [debouncedSearch, setDebouncedSearch] = useState(\"\")\n\n  const [refreshKey, setRefreshKey] = useState(0)\n  const { user } = useAuthStore()\n  const normalizedRole = user?.role.toLowerCase().trim()\n\n  // Debounce search input by 500ms\n  useEffect(() => {\n    const t = setTimeout(() => setDebouncedSearch(search), 500)\n    return () => clearTimeout(t)\n  }, [search])\n\n  const fetchReports = useCallback(async () => {\n    const qs = new URLSearchParams()\n    qs.set(\"limit\", \"10\")\n    qs.set(\"offset\", String(page))\n    if (debouncedSearch.trim()) qs.set(\"search\", debouncedSearch.trim())\n\n    const res = await fetch(`/api/goaml/reports?${qs.toString()}`, {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: { \"Content-Type\": \"application/json\" },\n      cache: \"no-store\",\n    })\n\n    const json = await res.json()\n    console.log(\"Fetched GOAML Reports:\", json)\n\n    if (json?.status) {\n      setReports(json.data?.reports || [])\n      setTotal(json.data?.total || 0)\n    } else {\n      setReports([])\n      setTotal(0)\n    }\n  }, [page, debouncedSearch])\n\n  // When debounced search changes, reset to page 1\n  useEffect(() => {\n    setPage(1)\n  }, [debouncedSearch])\n\n  useEffect(() => {\n    fetchReports()\n  }, [fetchReports, refreshKey])\n\n  return (\n    <div className=\"p-6\">\n      {/* Notice banner */}\n      {/* <div className=\"mb-4 rounded border border-orange-300 bg-orange-50 text-orange-800 p-3\">\n        <b>Notice !</b> Please update the identification issue details for all existing corporate customers' UBO, Partner, or Authorised Person to facilitate a seamless GOAML process.\n      </div> */}\n\n      {/* Header actions */}\n      <div className=\"flex justify-between items-center mb-4\">\n        <h2 className=\"text-xl font-bold\">GOAML Reporting</h2>\n        <div className=\"flex gap-2\">\n          <button\n            className=\"px-3 py-2 rounded border text-sm\"\n            onClick={() => setRefreshKey((k) => k + 1)}\n          >\n            Refresh\n          </button>\n          {/* {normalizedRole !== \"analyst\" && ( */}\n            <Link href=\"/dashboard/goaml-reporting/create\" className=\"px-3 py-2 rounded bg-blue-600 text-white text-sm\">+ Create New Report</Link>\n          {/* )} */}\n          {/* <button className=\"px-3 py-2 rounded border text-sm\">Validate XML File</button> */}\n        </div>\n      </div>\n\n      {/* Card container */}\n      <div className=\"rounded border bg-white\">\n        <div className=\"p-4 border-b\">\n          <input\n            type=\"text\"\n            placeholder=\"Search by customer name, ID, type, entity reference, or amount...\"\n            className=\"p-2 border rounded w-full\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n          />\n        </div>\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full\">\n            <thead>\n              <tr className=\"bg-gray-50 text-left\">\n                <th className=\"p-3 border-b\">Sl No.</th>\n                <th className=\"p-3 border-b\">Entity Reference No</th>\n                <th className=\"p-3 border-b\">Customer Name</th>\n                <th className=\"p-3 border-b\">Customer ID</th>\n                <th className=\"p-3 border-b\">Customer Type</th>\n                <th className=\"p-3 border-b\">Amount</th>\n                <th className=\"p-3 border-b\">Created Date</th>\n                <th className=\"p-3 border-b\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {reports.map((r: any, idx: number) => (\n                <tr key={r.id || idx} className=\"hover:bg-gray-50\">\n                  <td className=\"p-3 border-b\">{(page - 1) * 10 + idx + 1}</td>\n                  <td className=\"p-3 border-b\">{r.entity_reference || r.entityRefNo || \"-\"}</td>\n                  <td className=\"p-3 border-b\">{r.customer_name || r.customerName || \"-\"}</td>\n                  <td className=\"p-3 border-b\">{r.customer_id || r.customerId || \"-\"}</td>\n                  <td className=\"p-3 border-b\">\n                    <span className=\"bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs\">\n                      {r.customer.customer_type || r.customer.customer_type || \"-\"}\n                    </span>\n                  </td>\n                  <td className=\"p-3 border-b\">{r.estimated_value ?? \"-\"}</td>\n                  <td className=\"p-3 border-b\">{r.created_at ? new Date(r.created_at).toLocaleDateString() : r.createdDate || \"-\"}</td>\n                  <td className=\"p-3 border-b\">\n                    <div className=\"flex gap-2\">\n                      {user?.role !== \"Analyst\" && (\n                        <>\n                          <Link href={`/dashboard/goaml-reporting/edit/${r.id}`}>\n                            <button className=\"px-2 py-1 rounded border text-xs\">‚úèÔ∏è</button>\n                          </Link>\n                          <button className=\"px-2 py-1 rounded border text-xs\">üóëÔ∏è</button>\n                        </>\n                      )}\n                      <Link href={`/dashboard/goaml-reporting/${r.id}`} className=\"px-2 py-1 rounded border text-xs\">View</Link>\n                    </div>\n                  </td>\n                </tr>\n              ))}\n              {reports.length === 0 && (\n                <tr>\n                  <td className=\"p-4 text-center text-sm text-gray-500\" colSpan={8}>No reports found</td>\n                </tr>\n              )}\n            </tbody>\n          </table>\n        </div>\n        {/* Footer with pagination */}\n        <div className=\"p-4 flex items-center justify-between\">\n          <span className=\"text-sm text-gray-600\">Showing {(page - 1) * 10 + 1} to {Math.min(page * 10, total)} of {total} entries</span>\n          <div className=\"flex items-center gap-2\">\n            <button className=\"px-2 py-1 rounded border text-sm\" disabled={page === 1} onClick={() => setPage(page - 1)}>&lt;</button>\n            {/* simple numbered pages mimic */}\n            <span className=\"px-2 py-1 rounded bg-blue-600 text-white text-sm\">{page}</span>\n            <button className=\"px-2 py-1 rounded border text-sm\" disabled={reports.length < 10} onClick={() => setPage(page + 1)}>&gt;</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}"],"names":[],"mappings":"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"}